<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<script src="http://cdn.static.runoob.com/libs/jquery/1.10.2/jquery.min.js"></script>
	<style type="text/css">
		li{list-style: none}
		.date{width:150px;}
	</style>
</head>
<body>
<input type="text" id="text" value="">
<button id="send">发送</button>
<button id="close">关闭</button>
<div style="width:100%;height: 300px;overflow: auto;background: pink">
	<ul id="content">

	</ul>
</div>
<script>

	var sendmessage = '';
	var wsServer = 'ws://192.168.3.90:9502';
	var websocket = new WebSocket(wsServer);
	websocket.onopen = function (evt) {
	    console.log("Connected to WebSocket server.");
	};

	websocket.onclose = function (evt) {
	    console.log("Disconnected");
	};

	websocket.onmessage = function (evt) {
	    console.log('message: ' + evt.data);
	    $('#content').prepend('<li><span class="date">' + date_format('%H:%i:%s') + '</span> &nbsp;&nbsp;&nbsp;&nbsp;<b>' + evt.data + '</b></li>')
	};

	websocket.onerror = function (evt, e) {
	    console.log('Error occured: ' + evt.data);
	};	

	$("#send").click(function(){
		var msg = $("#text").val()
		websocket.send(msg)
        $("#text").val('')
	})

	$("#close").click(function(){
	    websocket.close()
	})

    document.onkeydown=function(event){
        var e = event || window.event || arguments.callee.caller.arguments[0];
        if(e && e.keyCode==13){ // enter 键
            $("#send").click()
        }
    };

    function date_format(format) {
        var mydate = new Date();//时间戳为10位需*1000，时间戳为13位的话不需乘1000
        var year = mydate.getFullYear();
        var month = (Array(2).join('0') + (mydate.getMonth() + 1)).slice(-2);
        var day = (Array(2).join('0') + mydate.getDate()).slice(-2);
        var hour = (Array(2).join('0') + mydate.getHours()).slice(-2);
        var minute = (Array(2).join('0') + mydate.getMinutes()).slice(-2);
        var second = (Array(2).join('0') + mydate.getSeconds()).slice(-2);

        str = format.replace('%Y',year);
        str = str.replace('%m',month);
        str = str.replace('%d',day);
        str = str.replace('%H',hour);
        str = str.replace('%i',minute);
        str = str.replace('%s',second);
        return str;
    }
</script>
</body>
</html>